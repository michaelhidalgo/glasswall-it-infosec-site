(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{106:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var l=n(3),r=n(8),a=(n(0),n(136)),o={title:"XML parsing vulnerable to XXE",sidebar_label:"XML parsing vulnerable to XXE"},i={unversionedId:"security_awareness/languages/TypeScript/xml",id:"security_awareness/languages/TypeScript/xml",isDocsHomePage:!1,title:"XML parsing vulnerable to XXE",description:"Description",source:"@site/docs/security_awareness/languages/TypeScript/xml.md",slug:"/security_awareness/languages/TypeScript/xml",permalink:"/docs/security_awareness/languages/TypeScript/xml",version:"current",sidebar_label:"XML parsing vulnerable to XXE",sidebar:"someSidebar",previous:{title:"Weak SSL/TLS protocols",permalink:"/docs/security_awareness/languages/TypeScript/WeakSSLTLSProtocols"}},c=[{value:"Description",id:"description",children:[{value:"Risk 1: Expose local file content (XXE: XML External Entity)",id:"risk-1-expose-local-file-content-xxe-xml-external-entity",children:[]},{value:"Risk 2: Denial of service (XEE: XML Entity Expansion)",id:"risk-2-denial-of-service-xee-xml-entity-expansion",children:[]}]},{value:"Vulnerable Code Example 1",id:"vulnerable-code-example-1",children:[]},{value:"Vulnerable Code Example 2",id:"vulnerable-code-example-2",children:[]},{value:"Mitigation",id:"mitigation",children:[]},{value:"Risk Assessment",id:"risk-assessment",children:[]},{value:"References",id:"references",children:[]}],s={toc:c};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(l.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"description"},"Description"),Object(a.b)("p",null,"XML specification allows the use of entities that can be internal or external (file system / network access ...) which could lead to vulnerabilities such as confidential file disclosures or SSRFs."),Object(a.b)("p",null,"XML External Entity (XXE) attacks can occur when an XML parser supports XML entities while processing XML received from an untrusted source."),Object(a.b)("h3",{id:"risk-1-expose-local-file-content-xxe-xml-external-entity"},"Risk 1: Expose local file content (XXE: XML External Entity)"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-java"},'<?xml version="1.0" encoding="ISO-8859-1"?>\n<!DOCTYPE foo [\n   <!ENTITY xxe SYSTEM "file:///etc/passwd" > ]>\n<foo>&xxe;</foo>\n')),Object(a.b)("h3",{id:"risk-2-denial-of-service-xee-xml-entity-expansion"},"Risk 2: Denial of service (XEE: XML Entity Expansion)"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-java"},'<?xml version="1.0"?>\n<!DOCTYPE lolz [\n <!ENTITY lol "lol">\n <!ELEMENT lolz (#PCDATA)>\n <!ENTITY lol1 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;">\n <!ENTITY lol2 "&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;">\n <!ENTITY lol3 "&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;">\n[...]\n <!ENTITY lol9 "&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;">\n]>\n<lolz>&lol9;</lolz>\n')),Object(a.b)("h2",{id:"vulnerable-code-example-1"},"Vulnerable Code Example 1"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-java"},'DocumentBuilder builder = df.newDocumentBuilder();\n\nXPathFactory xPathFactory = XPathFactory.newInstance();\nXPath xpath = xPathFactory.newXPath();\nXPathExpression xPathExpr = xpath.compile("/somepath/text()");\n\nxPathExpr.evaluate(new InputSource(inputStream));\n')),Object(a.b)("h2",{id:"vulnerable-code-example-2"},"Vulnerable Code Example 2"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-java"},"const libxmljs = require(\"libxmljs\");\nvar fs = require('fs');\n\nvar xml = fs.readFileSync('xxe.xml', 'utf8');\n\nvar xmlDoc = libxmljs.parseXmlString(xml, { noblanks: true, noent: true, nocdata: true }); // Noncompliant: noent set to true\n")),Object(a.b)("h2",{id:"mitigation"},"Mitigation"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-java"},"const libxmljs = require(\"libxmljs\");\nvar fs = require('fs');\n\nvar xml = fs.readFileSync('xxe.xml', 'utf8');\n\nvar xmlDoc = libxmljs.parseXmlString(xml); // Compliant: noent set to false by default\n")),Object(a.b)("h2",{id:"risk-assessment"},"Risk Assessment"),Object(a.b)("p",null,"These flaws can be used to extract data, execute a remote request from the server, scan internal systems, perform a denial-of-service attack, as well as execute other attacks. The business impact depends on the protection needs of all affected application and data."),Object(a.b)("h2",{id:"references"},"References"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE).html"},"A4:2017-XML External Entities (XXE)")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html"},"XML External Entity Prevention Cheat Sheet")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/611.html"},"CWE-611: Improper Restriction of XML External Entity Reference")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/827.html"},"CWE-827: Improper Control of Document Type Definition"))))}p.isMDXComponent=!0},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var l=n(0),r=n.n(l);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,l,r=function(e,t){if(null==e)return{};var n,l,r={},a=Object.keys(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),p=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,a=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(n),m=l,d=u["".concat(o,".").concat(m)]||u[m]||b[m]||a;return n?r.a.createElement(d,i(i({ref:t},s),{},{components:n})):r.a.createElement(d,i({ref:t},s))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,o=new Array(a);o[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var s=2;s<a;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);