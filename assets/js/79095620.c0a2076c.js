(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{100:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return s})),a.d(t,"toc",(function(){return l})),a.d(t,"default",(function(){return u}));var n=a(3),r=a(8),i=(a(0),a(136)),o={title:"Deserialization",sidebar_label:"Deserialization"},s={unversionedId:"security_awareness/languages/Python/Deserialization",id:"security_awareness/languages/Python/Deserialization",isDocsHomePage:!1,title:"Deserialization",description:"Description",source:"@site/docs/security_awareness/languages/Python/Deserialization.md",slug:"/security_awareness/languages/Python/Deserialization",permalink:"/docs/security_awareness/languages/Python/Deserialization",version:"current",sidebar_label:"Deserialization",sidebar:"someSidebar",previous:{title:"Request Redirect",permalink:"/docs/security_awareness/languages/Python/RequestRedirect"},next:{title:"Weak Encryption",permalink:"/docs/security_awareness/languages/Python/WeakEncryption"}},l=[{value:"Description",id:"description",children:[]},{value:"Vulnerable Code Example",id:"vulnerable-code-example",children:[]},{value:"Mitigation",id:"mitigation",children:[]},{value:"Risk Assessment",id:"risk-assessment",children:[]},{value:"References",id:"references",children:[]}],c={toc:l};function u(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"description"},"Description"),Object(i.b)("p",null,"User provided data such as URL parameters, POST data payloads or cookies should always be considered untrusted and tainted. Deserialization based on data supplied by the user could result in two types of attacks:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Remote code execution attacks, where the structure of the serialized data is changed to modify the behavior of the object being unserialized."),Object(i.b)("li",{parentName:"ul"},"Parameter tampering attacks, where data is modified to escalate privileges or change for example quantity or price of products.")),Object(i.b)("p",null,"The best way to protect against deserialization attacks is probably to challenge the use of the deserialization mechanism in the application. They are cases were the use of deserialization mechanism was not justified and created breaches (CVE-2017-9785)."),Object(i.b)("p",null,"If the use of deserialization mechanisms is valid in your context, the problem could be mitigated in any of the following ways:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Since the pickle module is not secure, never use it to deserialize untrusted data."),Object(i.b)("li",{parentName:"ul"},"Only use the PyYAML module with the default safe loader."),Object(i.b)("li",{parentName:"ul"},"Instead of using a native data interchange format, use a safe, standard format such as untyped JSON or structured data approaches such as Google Protocol Buffers."),Object(i.b)("li",{parentName:"ul"},"To ensure integrity is not compromised, add a digital signature (HMAC) to the serialized data that is validated before deserialization (this is only valid if the client doesn't need to modify the serialized data)"),Object(i.b)("li",{parentName:"ul"},"As a last resort, restrict deserialization to be possible only to specific, whitelisted classes.")),Object(i.b)("h2",{id:"vulnerable-code-example"},"Vulnerable Code Example"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"from flask import request\nimport pickle\nimport yaml\n\n@app.route('/pickle')\ndef pickle_loads():\n    file = request.files['pickle']\n    pickle.load(file) # Noncompliant; Never use pickle module to deserialize user inputs\n\n@app.route('/yaml')\ndef yaml_load():\n    data = request.GET.get(\"data\")\n    yaml.load(data, Loader=yaml.Loader) # Noncompliant; Avoid using yaml.load with unsafe yaml.Load\n")),Object(i.b)("h2",{id:"mitigation"},"Mitigation"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-python"},"from flask import request\nimport yaml\n\n@app.route('/yaml')\ndef yaml_load():\n    data = request.GET.get(\"data\")\n    yaml.load(data) # Compliant;  Prefer using yaml.load with the default safe loader\n")),Object(i.b)("h2",{id:"risk-assessment"},"Risk Assessment"),Object(i.b)("p",null,"The impact of deserialization flaws cannot be overstated. These flaws can lead to remote code execution attacks, one of the most serious attacks possible.\nThe business impact depends on the protection needs of the application and data."),Object(i.b)("h2",{id:"references"},"References"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization.html"},"A8:2017-Insecure Deserialization")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/134.html"},"CWE-134: Use of Externally-Controlled Format String")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/502.html"},"CWE-502: Deserialization of Untrusted Data"))))}u.isMDXComponent=!0},136:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return b}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),u=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=u(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(a),m=n,b=d["".concat(o,".").concat(m)]||d[m]||p[m]||i;return a?r.a.createElement(b,s(s({ref:t},c),{},{components:a})):r.a.createElement(b,s({ref:t},c))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var c=2;c<i;c++)o[c]=a[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);