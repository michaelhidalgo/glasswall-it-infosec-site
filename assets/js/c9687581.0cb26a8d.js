(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{117:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),a=n(8),s=(n(0),n(136)),o={title:"LDAP Injection",sidebar_label:"LDAP Injection"},i={unversionedId:"security_awareness/languages/Csharp/ldap_injection",id:"security_awareness/languages/Csharp/ldap_injection",isDocsHomePage:!1,title:"LDAP Injection",description:"Introduction",source:"@site/docs/security_awareness/languages/Csharp/ldap_injection.md",slug:"/security_awareness/languages/Csharp/ldap_injection",permalink:"/docs/security_awareness/languages/Csharp/ldap_injection",version:"current",sidebar_label:"LDAP Injection",sidebar:"someSidebar",previous:{title:"Common Security Pitfalls",permalink:"/docs/security_awareness/owasp/CommonSecurityPitfalls"},next:{title:"Command Injection",permalink:"/docs/security_awareness/languages/Csharp/command_injection"}},c=[],l={toc:c};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(s.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Introduction")),Object(s.b)("p",null,"LDAP (Lightweight Directory Access Protocol) is a software protocol that you have to be used in colleges and startup for enabling anyone to locate organizations, individuals, and other resources such as files and devices in a network, whether on the public Internet or on a corporate intranet."),Object(s.b)("p",null,"A common use of LDAP is to provide a central place to store usernames and passwords. This allows many different applications and services to connect to the LDAP server to validate users"),Object(s.b)("p",null,"Within LDAP names, the special characters ' ', '#', '\"', '+', ',', ';', '<', '>', '\\' and null must be escaped according to RFC 4514, for example by replacing them with the backslash character '\\' followed by the two hex digits corresponding to the ASCII code of the character to be escaped. Similarly, LDAP search filters must escape a different set of special characters (including but not limited to '*', '(', ')', '\\' and null) according to RFC 4515."),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Example1 of a vulnerable code")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-c"},'using System.DirectoryServices;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace WebApplicationDotNetCore.Controllers\n{\n    public class RSPEC2078LDAPInjectionNoncompliantController : Controller\n    {\n        public IActionResult Index()\n        {\n            return View();\n        }\n\n        public DirectorySearcher ds { get; set; }\n\n        public IActionResult Authenticate(string user, string pass)\n        {\n            ds.Filter = "(&(uid=" + user + ")(userPassword=" + pass + "))"; // Noncompliant\n\n            // If the special value "*)(uid=*))(|(uid=*" is passed as user, authentication is bypassed\n            // Indeed, if it is passed as a user, the filter becomes:\n            // (&(uid=*)(uid=*))(|(uid=*)(userPassword=...))\n            // as uid=* match all users, it is equivalent to:\n            // (|(uid=*)(userPassword=...))\n            // again, as uid=* match all users, the filter becomes useless\n\n            return Content(ds.FindOne() != null ? "success" : "fail");\n        }\n    }\n}\n')),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Example2 of a vulnerable code")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-c"},'using System;\nusing System.DirectoryServices;\n\npublic partial class WebForm : System.Web.UI.Page\n{\n    protected void Page_Load(object sender, EventArgs e)\n    {\n        string userName = Request.Params["user"];\n        string filter = "(uid=" + userName + ")";  // searching for the user entry\n\n        // In this example, if we send the * character in the user parameter which will\n        // result in the filter variable in the code to be initialized with (uid=*).\n        // The resulting LDAP statement will make the server return any object that\n        // contains a uid attribute.\n        DirectorySearcher searcher = new DirectorySearcher(filter);\n        SearchResultCollection results = searcher.FindAll();\n\n        // Iterate through each SearchResult in the SearchResultCollection.\n        foreach (SearchResult searchResult in results)\n        {\n            // ...\n        }\n    }\n}\n')),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Remediation")),Object(s.b)("p",null,"For the user-controlled portion of LDAP statements, consider one o:"),Object(s.b)("ul",null,Object(s.b)("li",null," ",Object(s.b)("i",null,Object(s.b)("b",null,"Allow only"))," a safe list of non-special characters."),Object(s.b)("li",null,"Disallow special character"),Object(s.b)("li",null,"Escape special characters.")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-c"},'using System.DirectoryServices;\nusing System.Text.RegularExpressions;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace WebApplicationDotNetCore.Controllers\n{\n    public class RSPEC2078LDAPInjectionCompliantController : Controller\n    {\n        public IActionResult Index()\n        {\n            return View();\n        }\n\n        public DirectorySearcher ds { get; set; }\n\n        public IActionResult Authenticate(string user, string pass)\n        {\n            // restrict the username and password to letters only\n            if (!Regex.IsMatch(user, "^[a-zA-Z]+$") || !Regex.IsMatch(pass, "^[a-zA-Z]+$"))\n            {\n                return BadRequest();\n            }\n\n            ds.Filter = "(&(uid=" + user + ")(userPassword=" + pass + "))"; // Now safe\n            return Content(ds.FindOne() != null ? "success" : "fail");\n        }\n    }\n}\n')),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Risk")),Object(s.b)("ul",null,Object(s.b)("li",null,"Authentication bypass"),Object(s.b)("li",null,"Sensitive information disclosure"),Object(s.b)("li",null,"Privilege escalation")),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"References ")),Object(s.b)("p",null,Object(s.b)("a",{parentName:"p",href:"https://www.geeksforgeeks.org/ldap-ldap-injectionprevention/"},"https://www.geeksforgeeks.org/ldap-ldap-injectionprevention/")),Object(s.b)("p",null,Object(s.b)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca3005"},"https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca3005")),Object(s.b)("p",null,Object(s.b)("a",{parentName:"p",href:"https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html"},"https://owasp.org/www-project-top-ten/2017/A1_2017-Injection.html")),Object(s.b)("p",null,Object(s.b)("a",{parentName:"p",href:"https://cwe.mitre.org/data/definitions/90"},"https://cwe.mitre.org/data/definitions/90")))}u.isMDXComponent=!0},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(n),d=r,m=p["".concat(o,".").concat(d)]||p[d]||b[d]||s;return n?a.a.createElement(m,i(i({ref:t},l),{},{components:n})):a.a.createElement(m,i({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var l=2;l<s;l++)o[l]=n[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);