(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{123:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return o})),r.d(t,"metadata",(function(){return l})),r.d(t,"toc",(function(){return s})),r.d(t,"default",(function(){return d}));var n=r(3),i=r(8),a=(r(0),r(136)),o={title:"Unrestricted Upload of File",sidebar_label:"Unrestricted Upload of File"},l={unversionedId:"security_awareness/languages/TypeScript/UnrestrictedUploadofFile",id:"security_awareness/languages/TypeScript/UnrestrictedUploadofFile",isDocsHomePage:!1,title:"Unrestricted Upload of File",description:"Description",source:"@site/docs/security_awareness/languages/TypeScript/UnrestrictedUploadofFile.md",slug:"/security_awareness/languages/TypeScript/UnrestrictedUploadofFile",permalink:"/docs/security_awareness/languages/TypeScript/UnrestrictedUploadofFile",version:"current",sidebar_label:"Unrestricted Upload of File",sidebar:"someSidebar",previous:{title:"JWT Sensitive Data Exposure",permalink:"/docs/security_awareness/languages/TypeScript/JWTSensitiveDataExposure"},next:{title:"Weak SSL/TLS protocols",permalink:"/docs/security_awareness/languages/TypeScript/WeakSSLTLSProtocols"}},s=[{value:"Description",id:"description",children:[]},{value:"Vulnerable Code Example",id:"vulnerable-code-example",children:[{value:"formidable module:",id:"formidable-module",children:[]},{value:"multer (Express.js middleware) module:",id:"multer-expressjs-middleware-module",children:[]}]},{value:"Mitigation",id:"mitigation",children:[{value:"formidable module:",id:"formidable-module-1",children:[]},{value:"multer (Express.js middleware) module:",id:"multer-expressjs-middleware-module-1",children:[]}]},{value:"Risk Assessment",id:"risk-assessment",children:[]},{value:"References",id:"references",children:[]}],c={toc:s};function d(e){var t=e.components,r=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"description"},"Description"),Object(a.b)("p",null,"These minimum restrictions should be applied when handling file uploads:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"the file upload folder to restrict untrusted files to a specific folder."),Object(a.b)("li",{parentName:"ul"},"the file extension of the uploaded file to prevent remote code execution.\nAlso the size of the uploaded file should be limited to prevent denial of service attacks. ")),Object(a.b)("h2",{id:"vulnerable-code-example"},"Vulnerable Code Example"),Object(a.b)("h3",{id:"formidable-module"},"formidable module:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"const Formidable = require('formidable');\n\nconst form = new Formidable(); // Noncompliant, this form is not safe\nform.uploadDir = \"\"; // because upload dir is not defined (by default os temp dir: /var/tmp or /tmp)\nform.keepExtensions = true; // and file extensions are kept\n")),Object(a.b)("h3",{id:"multer-expressjs-middleware-module"},"multer (Express.js middleware) module:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"const multer = require('multer');\n\nlet diskStorage = multer.diskStorage({ // Noncompliant: no destination specified\n  filename: (req, file, cb) => {\n    const buf = crypto.randomBytes(20);\n    cb(null, buf.toString('hex'))\n  }\n")),Object(a.b)("h2",{id:"mitigation"},"Mitigation"),Object(a.b)("h3",{id:"formidable-module-1"},"formidable module:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"const Formidable = require('formidable');\n\nconst form = new Formidable(); // Compliant\nform.uploadDir = \"./uploads/\";\nform.keepExtensions = false;\n")),Object(a.b)("h3",{id:"multer-expressjs-middleware-module-1"},"multer (Express.js middleware) module:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"const multer = require('multer');\n\nlet diskStorage = multer.diskStorage({  // Compliant\n  filename: (req, file, cb) => {\n    const buf = crypto.randomBytes(20);\n    cb(null, buf.toString('hex'))\n  },\n  destination: (req, file, cb) => {\n    cb(null, './uploads/')\n  }\n});\n\nlet diskupload = multer({\n  storage: diskStorage,\n});\n")),Object(a.b)("h2",{id:"risk-assessment"},"Risk Assessment"),Object(a.b)("p",null,"The impact of this vulnerability is high, supposed code can be executed in the server context or on the client side. The likelihood of detection for the attacker is high. The prevalence is common. As a result the severity of this type of vulnerability is high.\nIt is important to check a file upload module\u2019s access controls to examine the risks properly.\nServer-side attacks: The web server can be compromised by uploading and executing a web-shell which can run commands, browse system files, browse local resources, attack other servers, or exploit the local vulnerabilities, and so forth."),Object(a.b)("h2",{id:"references"},"References"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/434"},"CWE-434: Unrestricted Upload of File with Dangerous Type")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/400.html"},"CWE-400: Uncontrolled Resource Consumption")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://owasp.org/www-project-top-ten/"},"OWASP Top 10 2017 Category A4 - Insecure Direct Object References")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload"},"OWASP Unrestricted File Upload - Unrestricted File Upload")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://wiki.sei.cmu.edu/confluence/display/java/IDS56-J.+Prevent+arbitrary+file+upload"},"CERT, IDS56-J. - Prevent arbitrary file upload"))))}d.isMDXComponent=!0},136:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return b}));var n=r(0),i=r.n(n);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var c=i.a.createContext({}),d=function(e){var t=i.a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=d(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(r),m=n,b=u["".concat(o,".").concat(m)]||u[m]||p[m]||a;return r?i.a.createElement(b,l(l({ref:t},c),{},{components:r})):i.a.createElement(b,l({ref:t},c))}));function b(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,o=new Array(a);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var c=2;c<a;c++)o[c]=r[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,r)}m.displayName="MDXCreateElement"}}]);