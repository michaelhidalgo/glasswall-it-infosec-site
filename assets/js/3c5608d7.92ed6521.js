(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{136:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return b}));var r=n(0),i=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),u=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=u(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),m=u(n),d=r,b=m["".concat(s,".").concat(d)]||m[d]||p[d]||a;return n?i.a.createElement(b,o(o({ref:t},l),{},{components:n})):i.a.createElement(b,o({ref:t},l))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=d;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var l=2;l<a;l++)s[l]=n[l];return i.a.createElement.apply(null,s)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},87:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),i=n(8),a=(n(0),n(136)),s={title:"Memory Leak Vulnerability",sidebar_label:"Memory Leak Vulnerability"},o={unversionedId:"security_awareness/languages/C/MemoryLeak",id:"security_awareness/languages/C/MemoryLeak",isDocsHomePage:!1,title:"Memory Leak Vulnerability",description:"Description",source:"@site/docs/security_awareness/languages/C/MemoryLeak.md",slug:"/security_awareness/languages/C/MemoryLeak",permalink:"/docs/security_awareness/languages/C/MemoryLeak",version:"current",sidebar_label:"Memory Leak Vulnerability",sidebar:"someSidebar",previous:{title:"Use After Free (UAF) Vulnerability",permalink:"/docs/security_awareness/languages/C/uaf"},next:{title:"Double-Free Vulnerability",permalink:"/docs/security_awareness/languages/C/DoubleFree"}},c=[{value:"Description",id:"description",children:[]},{value:"Vulnerable Code Example",id:"vulnerable-code-example",children:[]},{value:"Mitigation",id:"mitigation",children:[]},{value:"Mitigation (Privileged Process, POSIX)",id:"mitigation-privileged-process-posix",children:[]},{value:"Risk Assessment",id:"risk-assessment",children:[]},{value:"References",id:"references",children:[]}],l={toc:c};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"description"},"Description"),Object(a.b)("p",null,"Developers should take steps to prevent sensitive information such as passwords, cryptographic keys, and other secrets from being inadvertently leaked. Preventive measures include attempting to keep such data from being written to disk."),Object(a.b)("p",null,"Two common mechanisms by which data is inadvertently written to disk are swapping and core dumps."),Object(a.b)("p",null,"Many general-purpose operating systems implement a virtual-memory-management technique called paging (also called swapping) to transfer pages between main memory and an auxiliary store, such as a disk drive. This feature is typically implemented as a task running in the kernel of the operating system, and its operation is invisible to the running program."),Object(a.b)("p",null,"A core dump is the recorded state of process memory written to disk for later examination by a debugger. Core dumps are typically generated when a program has terminated abnormally, either through an error resulting in a crash or by receiving a signal that causes such a termination."),Object(a.b)("p",null,"The POSIX standard system call for controlling resource limits, setrlimit(), can be used to disable the creation of core dumps, which prevents an attacker with the ability to halt the program from gaining access to sensitive data that might be contained in the dump."),Object(a.b)("h2",{id:"vulnerable-code-example"},"Vulnerable Code Example"),Object(a.b)("p",null,"In this code example, sensitive information is supposedly stored in the dynamically allocated buffer, secret, which is processed and eventually cleared by a call to ",Object(a.b)("inlineCode",{parentName:"p"},"memset_s()"),". The memory page containing secret can be swapped out to disk. If the program crashes before the call to ",Object(a.b)("inlineCode",{parentName:"p"},"memset_s()")," completes, the information stored in secret may be stored in the core dump."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-c"},"char *secret;\n \nsecret = (char *)malloc(size+1);\nif (!secret) {\n  /* Handle error */\n}\n \n/* Perform operations using secret... */\n \nmemset_s(secret, '\\0', size+1);\nfree(secret);\nsecret = NULL;\n")),Object(a.b)("h2",{id:"mitigation"},"Mitigation"),Object(a.b)("p",null,"To prevent the information from being written to a core dump, the size of core dumps that the program will generate should be set to 0 using ",Object(a.b)("inlineCode",{parentName:"p"},"setrlimit()"),":"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-c"},"#include <sys/resource.h>\n/* ... */\nstruct rlimit limit;\nlimit.rlim_cur = 0;\nlimit.rlim_max = 0;\nif (setrlimit(RLIMIT_CORE, &limit) != 0) {\n    /* Handle error */\n}\n \nchar *secret;\n \nsecret = (char *)malloc(size+1);\nif (!secret) {\n  /* Handle error */\n}\n \n/* Perform operations using secret... */\n \nmemset_s(secret, '\\0', size+1);\nfree(secret);\nsecret = NULL;\n")),Object(a.b)("h2",{id:"mitigation-privileged-process-posix"},"Mitigation (Privileged Process, POSIX)"),Object(a.b)("p",null,"The added security from using mlock() is limited.\nProcesses with elevated privileges can disable paging by locking memory in place using the POSIX mlock() function. Disabling paging ensures that memory is never copied to the hard drive, where it may be retained indefinitely in nonvolatile storage.\nThis compliant solution not only disables the creation of core files but also ensures that the buffer is not swapped to hard disk:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-c"},"#include <sys/resource.h>\n/* ... */\nstruct rlimit limit;\nlimit.rlim_cur = 0;\nlimit.rlim_max = 0;\nif (setrlimit(RLIMIT_CORE, &limit) != 0) {\n    /* Handle error */\n}\n \nlong pagesize = sysconf(_SC_PAGESIZE);\nif (pagesize == -1) {\n  /* Handle error */\n}\n \nchar *secret_buf;\nchar *secret;\n \nsecret_buf = (char *)malloc(size+1+pagesize);\nif (!secret_buf) {\n  /* Handle error */\n}\n \n/* mlock() may require that address be a multiple of PAGESIZE */\nsecret = (char *)((((intptr_t)secret_buf + pagesize - 1) / pagesize) * pagesize);\n \nif (mlock(secret, size+1) != 0) {\n    /* Handle error */\n}\n \n/* Perform operations using secret... */\n \nif (munlock(secret, size+1) != 0) {\n    /* Handle error */\n}\nsecret = NULL;\n \nmemset_s(secret_buf, '\\0', size+1+pagesize);\nfree(secret_buf);\nsecret_buf = NULL;\n")),Object(a.b)("h2",{id:"risk-assessment"},"Risk Assessment"),Object(a.b)("p",null,"Writing sensitive data to disk preserves it for future retrieval by an attacker, who may even be able to bypass the access restrictions of the operating system by using a disk maintenance program."),Object(a.b)("h2",{id:"references"},"References"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://cwe.mitre.org/data/definitions/528.html"},"CWE-528: Information leak through core dump files")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"https://wiki.sei.cmu.edu/confluence/display/c/AA.+Bibliography#AA.Bibliography-ISO-IECTR24772-2013"},"Information Technology-Programming Languages\u2014Guidance to Avoiding Vulnerabilities in Programming Languages through Language Selection and Use. Geneva, Switzerland: ISO, March 2013"))))}u.isMDXComponent=!0}}]);